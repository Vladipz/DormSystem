# UML Sequence Diagram: JWT + PKCE Авторизація

```mermaid
sequenceDiagram
    participant Клієнт
    participant Сервер
    participant БД

    Note over Клієнт, БД: Початок авторизації з PKCE

    Клієнт->>Клієнт: Генерація code_verifier
    Клієнт->>Клієнт: Створення code_challenge
    
    Клієнт->>Сервер: Запит авторизації (code_challenge, redirect_uri)
    Сервер->>БД: Збереження code_challenge
    БД-->>Сервер: Підтвердження збереження
    
    Сервер-->>Клієнт: Перенаправлення на сторінку входу
    
    Note over Клієнт, Сервер: Автентифікація користувача
    
    Клієнт->>Сервер: Надання облікових даних
    Сервер->>БД: Перевірка користувача
    БД-->>Сервер: Дані користувача
    
    Сервер->>БД: Генерація та збереження authorization_code
    БД-->>Сервер: Підтвердження збереження
    
    Сервер-->>Клієнт: Повернення authorization_code
    
    Note over Клієнт, БД: Обмін коду на токен
    
    Клієнт->>Сервер: Запит токену (authorization_code, code_verifier)
    Сервер->>БД: Отримання code_challenge
    БД-->>Сервер: Повернення code_challenge
    
    Сервер->>Сервер: Верифікація code_verifier з code_challenge
    
    alt Верифікація успішна
        Сервер->>Сервер: Генерація JWT токену
        Сервер->>БД: Збереження refresh_token
        БД-->>Сервер: Підтвердження збереження
        Сервер-->>Клієнт: Повернення JWT та refresh_token
        
        Note over Клієнт, БД: Авторизація завершена успішно
        
    else Верифікація неуспішна
        Сервер-->>Клієнт: Помилка авторизації
    end
```

## Опис потоку:

1. **Ініціалізація PKCE**: Клієнт генерує `code_verifier` та створює `code_challenge`
2. **Запит авторизації**: Клієнт надсилає запит з `code_challenge` на сервер
3. **Автентифікація**: Користувач вводить облікові дані
4. **Генерація коду**: Сервер створює `authorization_code` та зберігає в БД
5. **Обмін на токен**: Клієнт обмінює код разом з `code_verifier` на JWT токен
6. **Верифікація**: Сервер перевіряє відповідність `code_verifier` та `code_challenge`
7. **Видача токену**: При успішній верифікації клієнт отримує JWT токен

Діаграма показує основний потік успішної авторизації з використанням стандартів OAuth 2.0 + PKCE та JWT токенів. 